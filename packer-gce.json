{
  "variables": {
    "version": "0.9"
  },
  "builders":[{
    "name": "europe-west1-b",
    "type": "googlecompute",
    "account_file": "siq-haas.json",
    "source_image": "ubuntu-1404-trusty-v20150127",
    "zone": "europe-west1-b",
    "project_id": "siq-haas",
    "image_name": "packer-cloudbreak-{{ isotime \"2006-01-02\" }}",
    "tags": [
	"packer"
    ]
  }],
  "provisioners": [{
    "type": "file",
    "source": "scripts/register-ambari.sh",
    "destination": "/tmp/register-ambari.sh"
  },
  {
    "type": "file",
    "source": "scripts/public_host_script_gce.sh",
    "destination": "/tmp/public_host_script.sh"
  },
  {
    "type": "file",
    "source": "scripts/disk_mount_gce.sh",
    "destination": "/tmp/disk_mount.sh"
  },
  {

    "type": "shell",
    "script": "./user-data-script.sh",
    "execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E bash '{{ .Path }}'"
  }],
  "push": {
    "name": "sequenceiq/cbreak-gugli",
    "include": ["user-data-script.sh","siq-haas.json"]
  },
  "post-processors": [
      {
        "type": "atlas",
        "artifact": "sequenceiq/cbreak-gugli-artifact",
        "artifact_type": "aws.ami",
        "metadata": {
          "created_at": "{{timestamp}}"
        }
      }
    ]

}
